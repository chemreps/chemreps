from chemreps.bat import bag_maker
from chemreps.bat import bat
import numpy as np


def test_bat():
    bat_true = np.array([36.84, 36.84, 36.84, 36.84, 0.0, 0.0, 0.0, 0.0, 36.0, 36.0, 36.0, 20.78, 20.78, 13.6, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 2.094, 2.094, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 1.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 3.14, 3.14, 2.793, 2.793, 2.793, 2.793, 1.571, 1.571, 1.57, 1.57, 1.396, 1.396, 1.396, 1.396, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 9.67, 9.67, 9.67, 9.67, 9.67, 9.67, 9.67, 9.67, 9.67, 9.67, 5.55, 5.55, 5.55, 5.55, 5.098, 5.098, 5.098, 5.098, 4.24, 4.24, 3.95, 3.945, 3.758, 3.758, 3.758, 3.758, 3.703, 3.703, 2.842, 2.842, 2.748, 2.748, 2.621, 2.62, 2.389, 2.389, 2.062, 2.062, 1.853, 1.853, 0.0,
                         0.0, 0.0, 0.0, 0.0, 0.5, 0.5, 0.5, 0.5, 0.5, 0.5, 0.5, 0.5, 0.5, 0.5, 0.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 0.0, 3.14, 3.14, 1.57, 1.57, 1.57, 1.57, 1.396, 1.396, 0.0, 1.255, 1.255, 1.141, 1.141, 1.141, 1.141, 1.12, 1.12, 0.975, 0.975, 0.806, 0.806, 0.689, 0.658, 0.658, 0.6133, 0.6133, 0.612, 0.612, 0.5923, 0.5923, 0.559, 0.559, 0.549, 0.549, 0.5327, 0.5327, 0.518, 0.518, 0.4531, 0.452, 0.452, 0.3958, 0.3784, 0.3784, 0.378, 0.378, 0.3743, 0.3743, 0.3196, 0.3196, 0.306, 0.2896, 0.2896, 0.2605, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0], dtype=np.float16)
    dataset = 'data/sdf/'
    mfiles = 'data/sdf/butane.sdf'
    bags, bag_sizes = bag_maker(dataset)
    rep = bat(mfiles, bags, bag_sizes)
    assert np.all(np.abs(bat_true-rep) <= 1e-4) == True


if __name__ == "__main__":
    print("This is a test of the bat representation in chemreps to be evaluated with pytest")
